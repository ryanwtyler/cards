<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../my-attempt/my-attempt.html">


<dom-module id="my-card">
  
  
  <template>
    <style>
      td {
        background-color: white;
      }
      div.used {
        text-decoration: line-through;
      }
      .isGreen {
        background-color: green;
      }
      .bg-text {
        color: gray;
        background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='50px' width='120px'><text x='0' y='15' fill='red' font-size='20px'>I love SVG!</text></svg>");
      };

    
    
    </style>
    
      

       
    <table border=1>
      <tr>
        <td colspan=4>Athlete Name:  [[lifter.name]]</td>
        <td colspan=2>Category:  [[lifter.category]]</td>
      </tr>
      <tr rowspan=3>
        <td colspan=4>Team:  [[lifter.team]]</td>
        <td colspan=2>BW:  [[lifter.bodyWeight]]</td>
      </tr>
      <tr rowspan=3>
        <td colspan=3 class="tallcell">Snatch</td>
        <td colspan=3 class="tallcell">Clean & Jerk</td>
      </tr>
      <tr>
        <td align="center"><div class="attemptNumber">1</div></td>
        <td align="center"><div class="attemptNumber">2</div></td>
        <td align="center"><div class="attemptNumber">3</div></td>
        <td align="center"><div class="attemptNumber">1</div></td>
        <td align="center"><div class="attemptNumber">2</div></td>
        <td align="center"><div class="attemptNumber">3</div></td>
      </tr>
      <tr>
        <td><div class$="{{divClass}}"> {{arrayItem(lifter.attempts.*, 0, 'declared')}}</div></td>
        <td><div class="bg-text" bgtext="auto">auto:  {{arrayItem(lifter.attempts.*, 1, 'auto')}}</div></td>
        <td><div class="bg-text" bgtext="auto">[[arrayItem(lifter.attempts.*, 2, 'auto')]]</div></td> 
        <td><div class$="{{divClass}}">{{arrayItem(lifter.attempts.*, 3, 'declared')}}</div></td>
        <td><div>[[arrayItem(lifter.attempts.*, 4, 'auto')]]</div></td>
        <td><div>[[arrayItem(lifter.attempts.*, 5, 'auto')]]</div></td> 
      </tr>
      <tr>
        <td><div class="bg-text">sign</div></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "declared", "liftNum": 2 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "declared", "liftNum": 3 }'></my-attempt></td> 
        
        <td><div class="bg-text">sign</div></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "declared", "liftNum": "5" }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "declared", "liftNum": "6" }'></my-attempt></td> 
      </tr>
      <tr>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 1 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 2 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 3 }'></my-attempt></td>
        
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 4 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 5 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change1", "liftNum": 6 }'></my-attempt></td>
      </tr>
      <tr>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 1 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 2 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 3 }'></my-attempt></td>
        
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 4 }' ></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 5 }'></my-attempt></td>
        <td><my-attempt attempts="{{lifter.attempts}}" position='{ "change": "change2", "liftNum": 6 }'></my-attempt></td>
      </tr>
      
      
      <tr>
        <td colspan=3>
          
            <table>
            <tr><td>&nbsp;</td></tr>
            <tr><td><div>Total:  [[lifter.total]] kg</div></td></tr>
              <tr><td>&nbsp</td></tr>
          </table>
          
        </td>
          <td colspan=3>
          <table>
            <tr><td>&nbsp;</td></tr>
            <tr><td><div>Signature</div></td></tr>
              <tr><td>&nbsp</td></tr>
          </table>
        </td>
      </tr>
  
</table>

     
      
    
    
      
      
      
  
  </template>
 

  <script>
    
    Polymer({
      is: 'my-card',
      properties: {
        
        disabledString: {
          type: Boolean,
          value: true
        },
        currentChange: {
          type:  Number,
          value: 0,
          notify: true
        },
        meetId: {
          type: Number
        },
        lifter: {
          type: Object,
          notify: true
        },
        divClass:  {
          type: String,
          computed:  'computeClass(lifter.attempts.0.made, lifter.attempts.0.change1)',
          reflectToAttribute: true
        }
        
      },
      observers: [
        'dataChanged(lifter.attempts.*)'

        ],
      listeners: {
        'madeLift': 'makeLift'
      },
      computeClass: function(made, chg1) {
        if(chg1 != null) {
          return "used";
        }
        if (made) {
          return "isGreen";
        }
        
      },
      _copmputeDisabled: function(l_attempts, positionLift, positionChange) {
        var attemptNumber = l_attempts.base.length -1;
        if (attemptNumber == positionLift) {
          if (l_attempts.base[attemptNumber].declared == null) {
            return (positionChange !=0);
          }
          if (l_attempts.base[attemptNumber].change1 == null) {
            return (positionChange !=1); 
          }
          if (l_attempts.base[attemptNumber].change2 == null) {
            return (positionChange !=2); 
          }
        }
        else {
          return true;
        }
        
      },
      makeLift: function(iWeight) {
        console.log("make lift: " + this.lifter.name);
        this.set('lifter.total', this.lifter.total + iWeight.detail);
        this.set('lifter.attempts.' + this.lifter.currentLift + '.made', true);
        this.set('lifter.currentLift', this.lifter.currentLift + 1);
        this.push('lifter.attempts', {auto: iWeight.detail+1, declared: null, change1: null, change2: null});
        
        this.set('lifter.nextWeight', iWeight.detail+1);
        /*
        this.set('meetData.' + this.$.lifterCards.keyForElement(model) + '.liftsLeft', model.data.liftsLeft-1);
        this.set('meetData.' + this.$.lifterCards.keyForElement(model) + '.currentLift', model.data.currentLift+1);
        //model.data.currentChange = 0;
        this.set('meetData.currentWeight', this.$$("my-card:nth-of-type(2)").data.nextWeight);
  */
      },
      arrayItem: function(change, index, path) {
        // this.get(path, root) returns a value for a path
        // relative to a root object.
        return this.get(path, change.base[index]);
      },
      arrayItem2: function(change, index) {
        // this.get(path, root) returns a value for a path
        // relative to a root object.
        return change.base[index];
      },
      
      
      dataChanged: function (newVal) {
        if(newVal.path.indexOf("change1") > 0) {
          if(newVal.base[0].change1 > 0) {
            
            
            this.set('disabledString', false);
            //this.set('divStrike', "text-decoration:line-through");
             this.set('lifter.nextWeight', newVal.base[0].change1);
            
          }
        }
        else if(newVal.path.indexOf("change2") > 0) {
          if(newVal.base[0].change1 > 0) {
            this.set('lifter.nextWeight', newVal.base[0].change2);

            this.set('lifter.strikeString', "text-decoration:line-through");
          }
        }
        
      },
      change2Changed: function (newVal) {
        if(newVal > 0) {
          this.set('lifter.nextWeight', newVal);

          this.set('lifter.strikeString', "text-decoration:line-through");
        }
      }
      
    });
  
  </script>

</dom-module>




